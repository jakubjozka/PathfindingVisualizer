<Window x:Class="PathfindingVisualizer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PathfindingVisualizer.ViewModels"
        xmlns:models="clr-namespace:PathfindingVisualizer.Models"
        xmlns:helpers="clr-namespace:PathfindingVisualizer.Helpers"
        mc:Ignorable="d"
        Title="Pathfinding Visualizer" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <local:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <helpers:NodeTypeToColorConverter x:Key="NodeTypeToColorConverter"/>

        <Style x:Key="DarkComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#27AE60"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Focusable="false"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press">
                                <ToggleButton.Style>
                                    <Style TargetType="ToggleButton">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ToggleButton">
                                                    <Border Name="ToggleBorder" Background="#34495E" BorderBrush="#27AE60" BorderThickness="2">
                                                        <Grid>
                                                            <ContentPresenter Content="{TemplateBinding Content}" 
                                                                              Margin="5,3" 
                                                                              VerticalAlignment="Center" 
                                                                              HorizontalAlignment="Left"/>
                                                            <Path HorizontalAlignment="Right" 
                                                                  Margin="0,0,5,0"
                                                                  VerticalAlignment="Center"
                                                                  Data="M 0 0 L 4 4 L 8 0 Z"
                                                                  Fill="White"/>
                                                        </Grid>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="ToggleBorder" Property="Background" Value="#405060"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ToggleButton.Style>
                                <ContentPresenter Content="{TemplateBinding SelectionBoxItem}"
                                                  ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                  IsHitTestVisible="False">
                                    <ContentPresenter.Resources>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="White"/>
                                        </Style>
                                    </ContentPresenter.Resources>
                                </ContentPresenter>
                            </ToggleButton>
                            <Popup IsOpen="{TemplateBinding IsDropDownOpen}"
                                   Placement="Bottom"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Border Background="#2C3E50" 
                                        BorderBrush="#27AE60" 
                                        BorderThickness="2"
                                        MinWidth="{TemplateBinding ActualWidth}"
                                        MaxHeight="200">
                                    <ScrollViewer Margin="2">
                                        <StackPanel IsItemsHost="True"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkComboBoxItemStyle" TargetType="ComboBoxItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border Name="Border" Background="#2C3E50" Padding="8,5">
                            <ContentPresenter>
                                <ContentPresenter.Resources>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="White"/>
                                    </Style>
                                </ContentPresenter.Resources>
                            </ContentPresenter>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#27AE60"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#1E8449"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True"/>
                                    <Condition Property="IsHighlighted" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="Background" Value="#27AE60"/>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>
        
        <!-- Control Panel -->
        <Border Grid.Row="0" Grid.ColumnSpan="2" Background="#2C3E50" Padding="10">

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">

                <!-- Draw Mode Buttons -->
                <GroupBox Header="Draw Mode" Foreground="White" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <RadioButton x:Name="RadioStart" Content="Start"
                                     Foreground="White" Margin="5"
                                     IsChecked="False"
                                     GroupName="DrawMode"/>
                        <RadioButton x:Name="RadioEnd" Content="End"
                                     Foreground="White" Margin="5"
                                     GroupName="DrawMode"/>

                        <StackPanel Orientation="Vertical" Margin="5">
                            <RadioButton x:Name="RadioTerrain" Content="Terrain"
                                         Foreground="White"
                                         IsChecked="True"
                                         GroupName="DrawMode"/>
                            <ComboBox x:Name="TerrainSelector"
                                      Width="100"
                                      Height="25"
                                      Margin="0,3,0,0"
                                      SelectedIndex="0"
                                      Cursor="Hand"
                                      Style="{StaticResource DarkComboBoxStyle}"
                                      ItemContainerStyle="{StaticResource DarkComboBoxItemStyle}">
                                <ComboBoxItem Content="Wall"/>
                                <ComboBoxItem Content="Grass (2x)"/>
                                <ComboBoxItem Content="Mud (5x)"/>
                            </ComboBox>
                        </StackPanel>

                        <RadioButton x:Name="RadioErase" Content="Erase"
                                     Foreground="White" Margin="5"
                                     GroupName="DrawMode"/>
                    </StackPanel>
                </GroupBox>

                <!-- Action Buttons -->
                <GroupBox Header="Actions" Foreground="White" Margin="5">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <ComboBox x:Name="AlgorithmSelector"
                                  Width="180"
                                  Height="30"
                                  Margin="5"
                                  SelectedIndex="0"
                                  Cursor="Hand"
                                  Style="{StaticResource DarkComboBoxStyle}"
                                  ItemContainerStyle="{StaticResource DarkComboBoxItemStyle}">
                            <ComboBoxItem Content="Dijkstra"/>
                            <ComboBoxItem Content="A*"/>
                            <ComboBoxItem Content="BFS"/>
                            <ComboBoxItem Content="Multi-Target Dijkstra"/>
                            <ComboBoxItem Content="Bellman-Ford"/>
                        </ComboBox>

                        <Button x:Name="BtnVisualize"
                                Content="Visualize"
                                Width="100"
                                Height="30"
                                Margin="5"
                                Background="#27AE60"
                                Foreground="White"
                                FontWeight="Bold"
                                Cursor="Hand"/>
                        <Button x:Name="BtnClearPath" Content="Clear Path"
                                Width="100" Height="30" Margin="5"
                                Background="#E67E22" Foreground="White"
                                Cursor="Hand"/>
                        <Button x:Name="BtnClearGrid" Content="Clear Grid"
                                Width="100" Height="30" Margin="5"
                                Background="#E74C3C" Foreground="White"
                                Cursor="Hand"/>
                    </StackPanel>
                </GroupBox>

                <!-- Speed Slider -->
                <GroupBox Header="Speed" Foreground="White" Margin="5">
                    <StackPanel Orientation="Vertical" Width="120">
                        <TextBlock Text="{Binding AnimationDelay, StringFormat='Delay: {0}ms'}" 
                                   Foreground="White" 
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,5"/>
                        <Slider x:Name="SpeedSlider"
                                Minimum="1"
                                Maximum="50"
                                Value="{Binding AnimationDelay, Mode=TwoWay}"
                                TickFrequency="1"
                                IsSnapToTickEnabled="True"
                                VerticalAlignment="Center"
                                Cursor="Hand"/>
                        <Grid Margin="0,2,0,0">
                            <TextBlock Text="Fast" Foreground="#95A5A6" FontSize="10" HorizontalAlignment="Left"/>
                            <TextBlock Text="Slow" Foreground="#95A5A6" FontSize="10" HorizontalAlignment="Right"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Border>

        <!-- Legend -->
        <Border Grid.Row="1" Background="#ECF0F1" Padding="10">
            <GroupBox Grid.Row="1" Header="Legend" Foreground="Black" Margin="5" HorizontalAlignment="Center" BorderBrush="#2C3E50" BorderThickness="1">
                <WrapPanel Orientation="Horizontal" MaxWidth="1100" >
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#2ECC71" Margin="0,0,4,0"/>
                        <TextBlock Text="Start" Foreground="Black" VerticalAlignment="Center" FontSize="11" FontStyle="Italic"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#E74C3C" Margin="0,0,4,0"/>
                        <TextBlock Text="End" Foreground="Black" VerticalAlignment="Center" FontSize="11" FontStyle="Italic"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#34495E" Margin="0,0,4,0"/>
                        <TextBlock Text="Wall" Foreground="Black" VerticalAlignment="Center" FontSize="11" FontStyle="Italic"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#90EE90" Margin="0,0,4,0"/>
                        <TextBlock Foreground="Black" VerticalAlignment="Center" FontSize="11">
                            <Run Text="Grass" FontStyle="Italic"/>
                            <Run Text="(2x)"/>
                        </TextBlock>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#8B4513" Margin="0,0,4,0"/>
                        <TextBlock Foreground="Black" VerticalAlignment="Center" FontSize="11">
                            <Run Text="Mud" FontStyle="Italic"/>
                            <Run Text="(5x)"/>
                        </TextBlock>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#3498DB" Margin="0,0,4,0"/>
                        <TextBlock Text="Visited" Foreground="Black" VerticalAlignment="Center" FontSize="11" FontStyle="Italic"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#F39C12" Margin="0,0,4,0"/>
                        <TextBlock Text="Path" Foreground="Black" VerticalAlignment="Center" FontSize="11" FontStyle="Italic"/>
                    </StackPanel>
                </WrapPanel>
            </GroupBox>
        </Border>
        
        <!-- Grid Visualization Area -->
        <Border Grid.Row="2" Grid.Column="0" Background="#ECF0F1" Padding="20">
            <Viewbox Stretch="Uniform">
                <ItemsControl x:Name="GridControl" Width="1000" Height="500">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="25" Columns="50"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#BDC3C7" BorderThickness="0.5"
                                    Background="{Binding Type, Converter={StaticResource NodeTypeToColorConverter}}"
                                    MouseLeftButtonDown="Node_MouseLeftButtonDown"
                                    MouseEnter="Node_MouseEnter">
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Viewbox>
        </Border>

        <!-- Statistics Panel -->
        <Border Grid.Row="1" Grid.Column="1" Grid.RowSpan="2" Background="#34495E" Padding="15">
            <StackPanel>
                <TextBlock Text="Statistics"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="White"
                           Margin="0, 0, 0, 20"
                           HorizontalAlignment="Center"/>

                <GroupBox Header="Algorithm" Foreground="White" Margin="0, 0, 0, 15">
                    <TextBlock Text="{Binding CurrentAlgorithm}"
                               Foreground="#27AE60"
                               FontSize="15"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"/>
                </GroupBox>

                <GroupBox Header="Time Taken" Foreground="White" Margin="0, 0, 0, 15">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding TimeTaken, StringFormat='{}{0:F3}'}" 
                                   Foreground="Wheat" 
                                   FontSize="24" 
                                   FontWeight="Bold"/>
                        <TextBlock Text=" seconds"
                                   Foreground="#95A5A6"
                                   FontSize="14"
                                   VerticalAlignment="Bottom"
                                   Margin="5, 0, 0, 3"/>
                    </StackPanel>
                </GroupBox>
                
                <GroupBox Header="Nodes Explored" Foreground="White" Margin="0, 0, 0, 15">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding NodesExplored}"
                                   Foreground="#3498DB"
                                   FontSize="24"
                                   FontWeight="Bold"/>
                        <TextBlock Text=" nodes"
                                   Foreground="#95A5A6"
                                   FontSize="14"
                                   VerticalAlignment="Bottom"
                                   Margin="5, 0, 0, 3"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Path Length" Foreground="White" Margin="0, 0, 0, 15">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding PathLength}"
                                   Foreground="#F39C12"
                                   FontSize="24"
                                   FontWeight="Bold"/>
                        <TextBlock Text=" steps"
                                   Foreground="#95A5A6"
                                   FontSize="14"
                                   VerticalAlignment="Bottom"
                                   Margin="5, 0, 0, 3"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Path Cost" Foreground="White" Margin="0, 0, 0, 15">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding PathCost}"
                                   Foreground="#E67E22"
                                   FontSize="24"
                                   FontWeight="Bold"/>
                        <TextBlock Text=" units"
                                   Foreground="#95A5A6"
                                   FontSize="14"
                                   VerticalAlignment="Bottom"
                                   Margin="5, 0, 0, 3"/>
                    </StackPanel>
                </GroupBox>

                <Border Background="#2C3E50" 
                        Padding="10" 
                        CornerRadius="5"
                        Margin="0,10,0,0">
                    <TextBlock Text="💡 Path Cost accounts for terrain weights (Grass: 2x, Mud: 5x)" 
                               Foreground="#95A5A6" 
                               FontSize="11"
                               TextWrapping="Wrap"
                               LineHeight="16"/>
                </Border>
            </StackPanel>
        </Border>
    </Grid>
</Window>
