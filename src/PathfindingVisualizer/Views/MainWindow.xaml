<Window x:Class="PathfindingVisualizer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PathfindingVisualizer.ViewModels"
        xmlns:models="clr-namespace:PathfindingVisualizer.Models"
        xmlns:helpers="clr-namespace:PathfindingVisualizer.Helpers"
        mc:Ignorable="d"
        Title="Pathfinding Visualizer" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <local:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <helpers:NodeTypeToColorConverter x:Key="NodeTypeToColorConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Control Panel -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="10">

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">

                <!-- Draw Mode Buttons -->
                <GroupBox Header="Draw Mode" Foreground="White" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <RadioButton x:Name="RadioStart" Content="Start"
                                     Foreground="White" Margin="5"
                                     IsChecked="False"
                                     GroupName="DrawMode"/>
                        <RadioButton x:Name="RadioEnd" Content="End"
                                     Foreground="White" Margin="5"
                                     GroupName="DrawMode"/>

                        <StackPanel Orientation="Vertical" Margin="5">
                            <RadioButton x:Name="RadioTerrain" Content="Terrain"
                                         Foreground="White"
                                         IsChecked="True"
                                         GroupName="DrawMode"/>
                            <ComboBox x:Name="TerrainSelector"
                                      Width="100"
                                      Height="25"
                                      Margin="0,3,0,0"
                                      SelectedIndex="0"
                                      Cursor="11">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="Background" Value="#34495E"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="BorderBrush" Value="#27AE60"/>
                                        <Setter Property="BorderThickness" Value="2"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ComboBox">
                                                    <Grid>
                                                        <ToggleButton Focusable="false"
                                      IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                      ClickMode="Press">
                                                            <ToggleButton.Style>
                                                                <Style TargetType="ToggleButton">
                                                                    <Setter Property="Template">
                                                                        <Setter.Value>
                                                                            <ControlTemplate TargetType="ToggleButton">
                                                                                <Border Name="ToggleBorder" Background="#34495E" BorderBrush="#27AE60" BorderThickness="2">
                                                                                    <Grid>
                                                                                        <ContentPresenter Content="{TemplateBinding Content}" 
                                                                          Margin="5,3" 
                                                                          VerticalAlignment="Center" 
                                                                          HorizontalAlignment="Left"/>
                                                                                        <Path HorizontalAlignment="Right" 
                                                              Margin="0,0,5,0"
                                                              VerticalAlignment="Center"
                                                              Data="M 0 0 L 4 4 L 8 0 Z"
                                                              Fill="White"/>
                                                                                    </Grid>
                                                                                </Border>
                                                                                <ControlTemplate.Triggers>
                                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                                        <Setter TargetName="ToggleBorder" Property="Background" Value="#405060"/>
                                                                                    </Trigger>
                                                                                </ControlTemplate.Triggers>
                                                                            </ControlTemplate>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </Style>
                                                            </ToggleButton.Style>
                                                            <ContentPresenter Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              IsHitTestVisible="False">
                                                                <ContentPresenter.Resources>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Foreground" Value="White"/>
                                                                    </Style>
                                                                </ContentPresenter.Resources>
                                                            </ContentPresenter>
                                                        </ToggleButton>
                                                        <Popup IsOpen="{TemplateBinding IsDropDownOpen}"
                               Placement="Bottom"
                               AllowsTransparency="True"
                               Focusable="False"
                               PopupAnimation="Slide">
                                                            <Border Background="#2C3E50" 
                                    BorderBrush="#27AE60" 
                                    BorderThickness="2"
                                    MinWidth="{TemplateBinding ActualWidth}"
                                    MaxHeight="200">
                                                                <ScrollViewer Margin="2">
                                                                    <StackPanel IsItemsHost="True"/>
                                                                </ScrollViewer>
                                                            </Border>
                                                        </Popup>
                                                    </Grid>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ComboBox.Style>
                                <ComboBox.ItemContainerStyle>
                                    <Style TargetType="ComboBoxItem">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ComboBoxItem">
                                                    <Border Name="Border" Background="#2C3E50" Padding="8,5">
                                                        <ContentPresenter>
                                                            <ContentPresenter.Resources>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="White"/>
                                                                </Style>
                                                            </ContentPresenter.Resources>
                                                        </ContentPresenter>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsHighlighted" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="#27AE60"/>
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Border" Property="Background" Value="#1E8449"/>
                                                        </Trigger>
                                                        <MultiTrigger>
                                                            <MultiTrigger.Conditions>
                                                                <Condition Property="IsSelected" Value="True"/>
                                                                <Condition Property="IsHighlighted" Value="True"/>
                                                            </MultiTrigger.Conditions>
                                                            <Setter TargetName="Border" Property="Background" Value="#27AE60"/>
                                                        </MultiTrigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ComboBox.ItemContainerStyle>
                                <ComboBoxItem Content="Wall" Background="#2C3E50" Foreground="White"/>
                                <ComboBoxItem Content="Grass (2x)" Background="#2C3E50" Foreground="White"/>
                                <ComboBoxItem Content="Mud (5x)" Background="#2C3E50" Foreground="White"/>
                            </ComboBox>
                        </StackPanel>

                        <RadioButton x:Name="RadioErase" Content="Erase"
                                     Foreground="White" Margin="5"
                                     GroupName="DrawMode"/>
                    </StackPanel>
                </GroupBox>

                <!-- Action Buttons -->
                <GroupBox Header="Actions" Foreground="White" Margin="5">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- Generated by AI, I couldn't get the style right -->
                        <ComboBox x:Name="AlgorithmSelector"
                                  Width="180"
                                  Height="30"
                                  Margin="5"
                                  SelectedIndex="0"
                                  FontWeight="Bold"
                                  Cursor="Hand">
                            <ComboBox.Style>
                                <Style TargetType="ComboBox">
                                    <Setter Property="Background" Value="#34495E"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="BorderBrush" Value="#27AE60"/>
                                    <Setter Property="BorderThickness" Value="2"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ComboBox">
                                                <Grid>
                                                    <ToggleButton Focusable="false"
                                                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                                  ClickMode="Press">
                                                        <ToggleButton.Style>
                                                            <Style TargetType="ToggleButton">
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate TargetType="ToggleButton">
                                                                            <Border Name="ToggleBorder" Background="#34495E" BorderBrush="#27AE60" BorderThickness="2">
                                                                                <Grid>
                                                                                    <ContentPresenter Content="{TemplateBinding Content}" 
                                                                                                      Margin="5,3" 
                                                                                                      VerticalAlignment="Center" 
                                                                                                      HorizontalAlignment="Left"/>
                                                                                    <Path HorizontalAlignment="Right" 
                                                                                          Margin="0,0,5,0"
                                                                                          VerticalAlignment="Center"
                                                                                          Data="M 0 0 L 4 4 L 8 0 Z"
                                                                                          Fill="White"/>
                                                                                </Grid>
                                                                            </Border>
                                                                            <ControlTemplate.Triggers>
                                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                                    <Setter TargetName="ToggleBorder" Property="Background" Value="#405060"/>
                                                                                </Trigger>
                                                                            </ControlTemplate.Triggers>
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </ToggleButton.Style>
                                                        <ContentPresenter Content="{TemplateBinding SelectionBoxItem}"
                                                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                                          IsHitTestVisible="False">
                                                            <ContentPresenter.Resources>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="White"/>
                                                                </Style>
                                                            </ContentPresenter.Resources>
                                                        </ContentPresenter>
                                                    </ToggleButton>
                                                    <Popup IsOpen="{TemplateBinding IsDropDownOpen}"
                                                           Placement="Bottom"
                                                           AllowsTransparency="True"
                                                           Focusable="False"
                                                           PopupAnimation="Slide">
                                                        <Border Background="#2C3E50" 
                                                                BorderBrush="#27AE60" 
                                                                BorderThickness="2"
                                                                MinWidth="{TemplateBinding ActualWidth}"
                                                                MaxHeight="200">
                                                            <ScrollViewer Margin="2">
                                                                <StackPanel IsItemsHost="True"/>
                                                            </ScrollViewer>
                                                        </Border>
                                                    </Popup>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ComboBox.Style>
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ComboBoxItem">
                                                <Border Name="Border" Background="#2C3E50" Padding="8,5">
                                                    <ContentPresenter>
                                                        <ContentPresenter.Resources>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Foreground" Value="White"/>
                                                            </Style>
                                                        </ContentPresenter.Resources>
                                                    </ContentPresenter>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsHighlighted" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="#27AE60"/>
                                                    </Trigger>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="#1E8449"/>
                                                    </Trigger>
                                                    <MultiTrigger>
                                                        <MultiTrigger.Conditions>
                                                            <Condition Property="IsSelected" Value="True"/>
                                                            <Condition Property="IsHighlighted" Value="True"/>
                                                        </MultiTrigger.Conditions>
                                                        <Setter TargetName="Border" Property="Background" Value="#27AE60"/>
                                                    </MultiTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                            <ComboBoxItem Content="Dijkstra"/>
                            <ComboBoxItem Content="A*"/>
                            <ComboBoxItem Content="BFS"/>
                            <ComboBoxItem Content="Multi-Target Dijkstra"/>
                        </ComboBox>

                        <Button x:Name="BtnVisualize"
                                Content="Visualize"
                                Width="100"
                                Height="30"
                                Margin="5"
                                Background="#27AE60"
                                Foreground="White"
                                FontWeight="Bold"
                                Cursor="Hand"/>
                        <Button x:Name="BtnClearPath" Content="Clear Path"
                                Width="100" Height="30" Margin="5"
                                Background="#E67E22" Foreground="White"
                                Cursor="Hand"/>
                        <Button x:Name="BtnClearGrid" Content="Clear Grid"
                                Width="100" Height="30" Margin="5"
                                Background="#E74C3C" Foreground="White"
                                Cursor="Hand"/>
                    </StackPanel>
                </GroupBox>

                <!-- Speed Slider -->
                <GroupBox Header="Speed" Foreground="White" Margin="5">
                    <StackPanel Orientation="Vertical" Width="120">
                        <TextBlock Text="{Binding AnimationDelay, StringFormat='Delay: {0}ms'}" 
                                   Foreground="White" 
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,5"/>
                        <Slider x:Name="SpeedSlider"
                                Minimum="1"
                                Maximum="50"
                                Value="{Binding AnimationDelay, Mode=TwoWay}"
                                TickFrequency="5"
                                IsSnapToTickEnabled="True"
                                VerticalAlignment="Center"
                                Cursor="Hand"/>
                        <Grid Margin="0,2,0,0">
                            <TextBlock Text="Fast" Foreground="#95A5A6" FontSize="10" HorizontalAlignment="Left"/>
                            <TextBlock Text="Slow" Foreground="#95A5A6" FontSize="10" HorizontalAlignment="Right"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Border>

        <!-- Legend -->
        <Border Grid.Row="1" Background="#2C3E50" Padding="10">
            <GroupBox Grid.Row="1" Header="Legend" Foreground="White" Margin="5" HorizontalAlignment="Center">
                <WrapPanel Orientation="Horizontal" MaxWidth="1100">
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#2ECC71" Margin="0,0,4,0"/>
                        <TextBlock Text="Start" Foreground="White" VerticalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#E74C3C" Margin="0,0,4,0"/>
                        <TextBlock Text="End" Foreground="White" VerticalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#34495E" Margin="0,0,4,0"/>
                        <TextBlock Text="Wall" Foreground="White" VerticalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#90EE90" Margin="0,0,4,0"/>
                        <TextBlock Text="Grass (2x)" Foreground="White" VerticalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#8B4513" Margin="0,0,4,0"/>
                        <TextBlock Text="Mud (5x)" Foreground="White" VerticalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#3498DB" Margin="0,0,4,0"/>
                        <TextBlock Text="Visited" Foreground="White" VerticalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="8, 3">
                        <Border Width="16" Height="16" Background="#F39C12" Margin="0,0,4,0"/>
                        <TextBlock Text="Path" Foreground="White" VerticalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                </WrapPanel>
            </GroupBox>
        </Border>
        
        <!-- Grid Visualization Area -->
        <Border Grid.Row="2" Background="#ECF0F1" Padding="20">
            <Viewbox Stretch="Uniform">
                <ItemsControl x:Name="GridControl" Width="1000" Height="500">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Rows="25" Columns="50"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="#BDC3C7" BorderThickness="0.5"
                                    Background="{Binding Type, Converter={StaticResource NodeTypeToColorConverter}}"
                                    MouseLeftButtonDown="Node_MouseLeftButtonDown"
                                    MouseEnter="Node_MouseEnter">
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Viewbox>
        </Border>
    </Grid>
</Window>
